{% extends 'base.html' %}

{% block title %}Mon Tableau de Bord - Assistance Voyage RDC{% endblock %}

{% block content %}

<div class="bg-blue-900 pb-24 pt-12">
    <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
        <div class="flex flex-col md:flex-row md:items-center md:justify-between gap-4">
            
            <div>
                <h1 class="text-3xl font-bold text-white">
                    Bonjour, {{ user.first_name|default:user.username }} !
                </h1>
                <p class="mt-2 text-blue-200">
                    Espace client sécurisé.
                </p>
            </div>

            <div class="flex items-center gap-3">
                <span class="hidden md:inline-flex items-center px-3 py-1 rounded-full text-xs font-medium bg-blue-800 text-blue-100 border border-blue-700">
                    <svg class="mr-1.5 h-2 w-2 text-green-400" fill="currentColor" viewBox="0 0 8 8"><circle cx="4" cy="4" r="3" /></svg>
                    Compte Actif
                </span>

                <a href="#nouveau-dossier" class="inline-flex items-center px-6 py-3 border border-transparent text-base font-bold rounded-md text-blue-900 bg-yellow-400 hover:bg-yellow-300 shadow-lg transform hover:scale-105 transition duration-200">
                    <svg class="w-5 h-5 mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 6v6m0 0v6m0-6h6m-6 0H6"></path></svg>
                    Nouveau Dossier
                </a>
            </div>

        </div>
    </div>
</div>

<div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 -mt-16 pb-12">
    
    {% if dossiers %}
        <div class="grid gap-6 mb-12 grid-cols-1 md:grid-cols-2 lg:grid-cols-3">
             {% for dossier in dossiers %}
                <div class="bg-white rounded-xl shadow-lg overflow-hidden border border-gray-100 hover:shadow-2xl transition duration-300 transform hover:-translate-y-1">
                    <div class="p-6 border-b border-gray-100 bg-gray-50 flex justify-between items-start">
                        <div>
                            <h3 class="font-bold text-xl text-blue-900">{{ dossier.categorie.nom }}</h3>
                            <p class="text-xs text-gray-500">Ref: #DOS-{{ dossier.id }}</p>
                        </div>
                        <span class="px-2 py-1 text-xs font-bold rounded-full uppercase tracking-wide
                            {% if dossier.statut == 'valide' %}bg-green-100 text-green-800
                            {% elif dossier.statut == 'refuse' %}bg-red-100 text-red-800
                            {% elif dossier.statut == 'analyse' %}bg-blue-100 text-blue-800
                            {% else %}bg-yellow-100 text-yellow-800{% endif %}">
                            {{ dossier.get_statut_display }}
                        </span>
                    </div>
                    <div class="p-6">
                                <div class="flex justify-between text-sm text-gray-600 mb-1">
                                    <span>Complétude</span>
                                    <span class="font-bold">{{ dossier.pourcentage_completion }}%</span>
                                </div>
                                <div class="w-full bg-gray-200 rounded-full h-2.5 mb-4">
                                    <div class="bg-blue-600 h-2.5 rounded-full" style="width: {{ dossier.pourcentage_completion }}%"></div>
                                </div>
                                <div class="p-6">
                            <p class="text-sm text-gray-500 mb-6">
                                {% if dossier.etape_creation < 3 %}
                                    <span class="text-yellow-600 font-bold">Inscription non terminée.</span> <br>
                                    Vous êtes à l'étape {{ dossier.etape_creation }}/3.
                                {% else %}
                                    {% if dossier.statut == 'brouillon' %}
                                        Il manque des documents.
                                    {% elif dossier.statut == 'analyse' %}
                                        Analyse en cours.
                                    {% endif %}
                                {% endif %}
                            </p>

                            {% if dossier.etape_creation < 3 %}
                                <a href="{% url 'wizard_dossier_step' dossier.categorie.id dossier.id %}" class="block w-full text-center bg-yellow-400 text-blue-900 font-bold py-2 px-4 rounded hover:bg-yellow-300 transition shadow-sm">
                                    Reprendre l'inscription &rarr;
                                </a>
                            {% else %}
                                <a href="{% url 'wizard_dossier_step' dossier.categorie.id dossier.id %}" class="block w-full text-center bg-blue-900 text-white font-bold py-2 px-4 rounded hover:bg-blue-800 transition">
                                    Gérer mes documents
                                </a>
                            {% endif %}
                        </div>
                    </div>
                </div>
                
             {% endfor %}
        </div>
    {% else %}
        <div class="bg-white rounded-xl shadow-lg p-8 text-center mb-12 border border-dashed border-gray-300">
            <h3 class="mt-2 text-sm font-medium text-gray-900">Aucun dossier en cours</h3>
            <p class="mt-1 text-sm text-gray-500">Cliquez sur le bouton jaune ci-dessus pour commencer.</p>
        </div>
    {% endif %}


    <div id="nouveau-dossier" class="border-t border-gray-200 pt-10 scroll-mt-24">
        <h2 class="text-2xl font-bold text-gray-900 mb-6 flex items-center">
            <span class="bg-blue-100 text-blue-900 w-8 h-8 rounded-full flex items-center justify-center mr-3 text-sm font-bold">+</span>
            Commencer une nouvelle procédure
        </h2>
        <p class="text-gray-600 mb-8 max-w-2xl">
            Cliquez sur le service désiré pour ouvrir un espace documentaire sécurisé.
        </p>

        <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6">
            {% for cat in categories %}
            <a href="{% url 'creer_dossier' cat.id %}" class="group relative bg-white rounded-xl shadow-sm border border-gray-200 p-6 hover:shadow-xl hover:border-yellow-400 transition duration-300 flex flex-col items-center text-center cursor-pointer transform hover:-translate-y-1">
                
                <div class="w-14 h-14 bg-gray-50 text-gray-600 rounded-full flex items-center justify-center mb-4 group-hover:bg-yellow-400 group-hover:text-blue-900 transition">
                     <svg class="w-8 h-8" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 6v6m0 0v6m0-6h6m-6 0H6"></path></svg>
                </div>

                <h3 class="text-lg font-bold text-gray-900 mb-2 group-hover:text-blue-900">{{ cat.nom }}</h3>
                <span class="text-blue-600 font-semibold text-sm group-hover:underline mt-auto">Ouvrir un dossier &rarr;</span>
            </a>
            {% endfor %}
        </div>
    </div>

</div>

<a href="#nouveau-dossier" class="md:hidden fixed bottom-6 right-6 z-50 bg-yellow-400 text-blue-900 rounded-full p-4 shadow-2xl flex items-center justify-center transform active:scale-95 transition">
    <svg class="w-8 h-8" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 4v16m8-8H4"></path></svg>
</a>

{% endblock %}